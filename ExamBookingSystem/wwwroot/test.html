<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h3>API Services Test</h3>

        <button class="btn btn-primary" onclick="testStripe()">Test Stripe</button>
        <button class="btn btn-success" onclick="testEmail()">Test Email</button>
        <button class="btn btn-info" onclick="testSlack()">Test Slack</button>
        <button class="btn btn-warning" onclick="testBooking()">Test Booking</button>

        <div id="results" class="mt-3"></div>
    </div>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
        const stripe = Stripe('pk_test_51Ri7PbECQKRSCDpzi5n5B0oclWVCPAbT32F1v3zEIooF0avPQTX2XWsjsTkF2sTPQgWnGIl8Ovd08JEUNxWUcEie00u5qO5lpt');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `alert alert-${type} mt-2`;
            div.textContent = message;
            document.getElementById('results').appendChild(div);
        }

        async function testStripe() {
            try {
                log('Testing Stripe connection...');
                const response = await fetch('/api/Payment/create-checkout-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        studentFirstName: "Test",
                        studentLastName: "User",
                        studentEmail: "test@example.com",
                        studentPhone: "+1234567890",
                        checkRideType: "Private",
                        preferredAirport: "KJFK",
                        searchRadius: 50
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    log(`✅ Stripe works! Session ID: ${data.sessionId}`, 'success');
                } else {
                    const error = await response.text();
                    log(`❌ Stripe error: ${error}`, 'danger');
                }
            } catch (error) {
                log(`❌ Network error: ${error.message}`, 'danger');
            }
        }

        async function testEmail() {
            try {
                log('Testing email service...');
                const response = await fetch('/api/Test/email?to=contact@mom-ai-agency.site&subject=Test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const result = await response.json();

                if (result.success) {
                    log('✅ Email service works!', 'success');
                } else {
                    log('❌ Email service failed', 'danger');
                }
            } catch (error) {
                log(`❌ Email test error: ${error.message}`, 'danger');
            }
        }

        async function testSlack() {
            try {
                log('Testing Slack service...');
                const response = await fetch('/api/Test/slack?message=Test notification', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                const result = await response.json();

                if (result.success) {
                    log('✅ Slack service works!', 'success');
                } else {
                    log('❌ Slack service failed', 'danger');
                }
            } catch (error) {
                log(`❌ Slack test error: ${error.message}`, 'danger');
            }
        }

        async function testBooking() {
            try {
                log('Testing booking creation...');
                const response = await fetch('/api/Booking/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        studentFirstName: "Test",
                        studentLastName: "Booking",
                        studentEmail: "test@example.com",
                        studentPhone: "+1234567890",
                        examType: "Private",
                        preferredAirport: "KJFK",
                        checkRideType: "Private",
                        searchRadius: 50,
                        preferredDate: new Date().toISOString()
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    log(`✅ Booking created: ${result.bookingId}`, 'success');
                } else {
                    const error = await response.text();
                    log(`❌ Booking error: ${error}`, 'danger');
                }
            } catch (error) {
                log(`❌ Booking test error: ${error.message}`, 'danger');
            }
        }
    </script>
</body>
</html>